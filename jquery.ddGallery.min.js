////////////////////////////////////////////////////////////////////////////////////
/*
 * jQuery ddGallery v2.4.4 :: 2012-04-02
 * http://inventurous.net/ddgallery
 *
 * Copyright (c) 2012, Darren Doyle
 * Free to use and abuse under the MIT license.
 * http://www.opensource.org/licenses/mit-license.php
 */
////////////////////////////////////////////////////////////////////////////////////
window.ddGalleryWaitForYoutube=true;if(typeof(onYouTubePlayerAPIReady)!="function"){function onYouTubePlayerAPIReady(){window.ddGalleryWaitForYoutube=false}}(function($){var galleryTpl,arrowTpl,youtubeLoaded=false,loadYoutubeAPI=function(){var newTag,firstScript;newTag=document.createElement("script");newTag.src="http://www.youtube.com/player_api";newTag.type="text/javascript";firstScript=document.getElementsByTagName("script")[0];firstScript.parentNode.insertBefore(newTag,firstScript)};galleryTpl='<div class="ddGallery-stage-wrapper" style="width:100%; height:100%;">';galleryTpl+='<div class="ddGallery-stage loading" style="width:100%; height:100%;"></div>';galleryTpl+='<div class="ddGallery-count"></div>';galleryTpl+='<div class="ddGallery-toggles">';galleryTpl+='<a href="javascript:;" class="ddGallery-fullScreen"><div><div></div></div></a>';galleryTpl+='<a href="javascript:;" class="ddGallery-zoom"></a>';galleryTpl+="</div>";galleryTpl+='<div class="ddGallery-caption-wrapper" style="position:absolute; bottom:0; overflow:hidden; width:100%; opacity:0">';galleryTpl+='<div class="ddGallery-caption"></div>';galleryTpl+="</div>";galleryTpl+="</div>";galleryTpl+='<div class="ddGallery-controls" style="position:absolute; bottom:0; overflow:hidden;">';galleryTpl+='<div class="ddGallery-thumbs-wrapper" style="position:relative; width:auto; height:100%; overflow:hidden">';galleryTpl+='<div class="ddGallery-thumbs" style="position:absolute; top:0; left:0; height:100%;"></div>';galleryTpl+="</div>";galleryTpl+="</div>";galleryTpl+='<div class="ddGallery-control-tab" style="position:absolute; overflow:hidden;"></div>';arrowTpl='<a class="ddGallery-arrows ddGallery-arrow-left" style="position:absolute; display:block; height:100%; top:0; left:0; overflow:hidden;" href="javascript:;">';arrowTpl+='<span class="circle" style="position:absolute; width:0; height:0; border-radius:100px; display:none;"></span>';arrowTpl+='<span class="arrow" style="position:absolute; width:0; height:0; display:none;"></span>';arrowTpl+="</a>";arrowTpl+='<a class="ddGallery-arrows ddGallery-arrow-right" style="position:absolute; display:block; height:100%; top:0; right:0; overflow:hidden;" href="javascript:;">';arrowTpl+='<span class="circle" style="position:absolute; width:0; height:0; border-radius:100px; display:none;"></span>';arrowTpl+='<span class="arrow" style="position:absolute; width:0; height:0; display:none;"></span>';arrowTpl+="</a>";$.ddGallery=function(element,options){var dd=this;dd.gal=$(element);dd.settings=$.extend({},$.ddGallery.defaultOptions,options);dd.id="ddGallery-gallery-"+(Math.floor(Math.random()*10000));dd.itemCount=dd.gal.children("a,img,div,iframe").length;dd.hover=false;dd.animating=false;dd.initial=true;dd.initialSpeed=250;dd.curItem=0;dd.youtubePlayers=[];dd.imageDimensions=[];dd.videoPlaying=false;dd.pinned=false;dd.autopinned=false;dd.touched=false;dd.fullScreen=false;dd.sH=0;dd.navSource="";dd.capSizes={heights:{},borders:{t:0,b:0},margins:{t:0,b:0},padding:{t:0,b:0}};dd.debug=$("#ddGallery-debug");dd.draw(dd)};$.ddGallery.defaultOptions={captions:true,externalCaptions:false,captionFadeSpeed:250,captionPause:2000,hideCaptions:true,count:true,countType:"total",hideCount:true,pinTab:true,pinned:false,autoPlay:false,arrows:true,keyboard:true,thumbs:true,hideThumbs:true,controlHideSpeed:150,controlScrollSpeed:350,controlPush:false,stageRotateType:"fade",stageRotateSpeed:500,stagePause:4000,rotate:true,playlist:false,hoverPause:true,enlarge:true,stretch:false,fullScreen:true,controlPushOnFull:true,hideThumbsOnFull:false,hideCaptionsOnFull:false,hideCountOnFull:true,zoom:false,hideZoom:true};$.ddGallery.prototype={draw:function(dd){if(dd.itemCount<=1){dd.settings.thumbs=false;dd.settings.arrows=false;dd.settings.count=false;dd.settings.stageRotateSpeed=250}switch(dd.settings.stageRotateType){case"fade":case"pushH":case"pushV":case"slideH":case"slideV":case"drop":case"lift":break;default:dd.settings.stageRotateType="fade"}if(dd.settings.playlist){dd.userPaused=!dd.settings.autoPlay;dd.settings.autoPlay=false}dd.gal.css({overflow:"hidden",position:(dd.gal.css("position")=="static")?"relative":dd.gal.css("position")});dd.origData=dd.gal.html();dd.origCSS={"z-index":dd.gal.css("z-index"),position:dd.gal.css("position"),top:dd.gal.css("top"),left:dd.gal.css("left"),width:dd.gal.css("width"),height:dd.gal.css("height"),margin:dd.gal.css("margin")};dd.orig=$("<div />").html(dd.gal.html());dd.gal.html(galleryTpl).ready(function(){var thumbContent="";dd.caption=dd.gal.find(".ddGallery-caption-wrapper");dd.controls=dd.gal.find(".ddGallery-controls");dd.tab=dd.gal.find(".ddGallery-control-tab");dd.tabB=parseInt(dd.tab.css("bottom"));dd.count=dd.gal.find(".ddGallery-count");dd.stage=dd.gal.find(".ddGallery-stage");dd.thumbWrap=dd.gal.find(".ddGallery-thumbs-wrapper");dd.thumbs=dd.thumbWrap.children(".ddGallery-thumbs");dd.zoom=dd.gal.find(".ddGallery-zoom");dd.full=dd.gal.find(".ddGallery-fullScreen");dd.mainZ=(dd.gal.css("z-index")=="auto")?0:parseInt(dd.gal.css("z-index"));dd.gal.find(".ddGallery-stage-wrapper").css({"z-index":dd.mainZ});dd.controls.css({"z-index":dd.mainZ+1});dd.tab.css({"z-index":dd.mainZ+1000});dd.zoom.parent(".ddGallery-toggles").css({"z-index":dd.mainZ+6});if(!dd.settings.externalCaptions){dd.caption.css({"z-index":dd.mainZ+5})}if(dd.settings.count){dd.count.css({display:"block","z-index":dd.mainZ+6})}else{dd.count.css({display:"none"})}if(dd.settings.zoom){dd.zoom.css({display:"none",opacity:0})}else{dd.zoom.css({display:"none"})}if(dd.settings.fullScreen){dd.full.css({display:"block",opacity:1})}else{dd.full.css({display:"none"})}if(!dd.settings.pinTab||(!dd.settings.captions&&!dd.settings.thumbs)||((dd.settings.controlPush&&!dd.settings.hideThumbs)&&(!dd.settings.captions||dd.settings.externalCaptions))){dd.tab.css({display:"none"});dd.settings.pinTab=false}else{dd.tab.css({left:Math.floor(dd.stage.width()/2)-Math.floor(dd.tab.outerWidth()/2)})}dd.orig.children("a, img, div, iframe").each(function(){var me=$(this),url="",thumb,cap,linkOut="",linkTarget="",type="img",thumbResize="",sourceId="",sourceClass="",itemId="ddGallery"+(Math.floor(Math.random()*1000000)),kid=me.children("img");href=me.attr("href"),forced=(me.attr("type")==undefined)?"":me.attr("type"),linkType=(href==""||href==undefined)?[,false]:(href.match(/http:\/\/(?:www\.|)(vimeo|youtube)\.com(?:.*)((?:\/)([a-zA-Z0-9-_]+)(?:$|&|\?)|((?:[0-9]\/)|(?:embed\/)|(?:v\/)|(?:v=))([a-zA-Z0-9-_]+)(?:$|&|\?))/i)||href.match(/.*(?=\.(jpg|jpeg|gif|png)(?:$|\?))/i)||[,false]);if(me.is("a")||me.is("img")){if(me.is("img")||((!linkType[1]||forced=="link")&&forced!="image")){if(me.is("a")){type="clickable";linkOut=me.attr("href");linkTarget=(me.attr("target")==undefined)?"":me.attr("target");me=kid}url=me.attr("src"),thumb=me.attr("src"),cap=me.attr("alt");thumbResize=";background-repeat:no-repeat round;background-size:auto 100%;"}else{if((linkType[1]=="jpg"||linkType[1]=="jpeg"||linkType[1]=="gif"||linkType[1]=="png")||forced=="image"){url=me.attr("href"),thumb=kid.attr("src"),cap=me.children("img").attr("alt")}else{if(linkType[1]=="youtube"){url=linkType[5];me.addClass(url);cap=me.attr("title");type="youtube";thumb="http://img.youtube.com/vi/"+linkType[5]+"/2.jpg";if(!youtubeLoaded){loadYoutubeAPI();youtubeLoaded=true}window.ddGalleryWaitForYoutube=(window.ddGalleryWaitForYoutube===undefined||window.ddGalleryWaitForYoutube===true)?true:false}else{if(linkType[1]=="vimeo"){url="http://player.vimeo.com/video/"+linkType[3]+"?api=1&player_id="+itemId;me.addClass(url);cap=me.attr("title");type="vimeo";$.ajax({type:"GET",url:"http://vimeo.com/api/v2/video/"+linkType[3]+".json",jsonp:"callback",dataType:"jsonp",success:function(data){dd.thumbs.find('a[itemId="'+itemId+'"]').css("background-image","url("+data[0]["thumbnail_small"]+")")}})}}}}}else{if(me.is("div")){sourceClass=me.attr("class");sourceId=me.attr("id");me.addClass(itemId);thumb=me.attr("thumb");cap=me.attr("title");type="div "}else{if(me.is("iframe")){sourceClass=me.attr("class");sourceId=me.attr("id");url=me.attr("src");me.addClass(url);thumb=me.attr("thumb");cap=me.attr("title");type="iframe"}}}sourceClass=(sourceClass==undefined)?"":sourceClass;sourceId=(sourceId==undefined)?"":sourceId;cap=(cap==undefined||cap==null||cap==""||cap==" ")?"&nbsp;":cap;thumb=(thumb==undefined)?"":";background-image:url("+thumb+")";thumbContent+='<a href="'+url+'" itemId="'+itemId+'" sourceId="'+sourceId+'" sourceClass="'+sourceClass+'" class="'+type+'" style="display:block;float:left'+thumb+thumbResize+'" title="'+cap+'" linkOut="'+linkOut+'" linkTarget="'+linkTarget+'"><span class="ddGallery-watermark"></span></a>';if(dd.settings.captions&&!dd.settings.externalCaptions){if(cap=="&nbsp;"){dd.capSizes.heights[itemId]={h:0,o:0}}else{dd.caption.children(".ddGallery-caption").html(cap);dd.capSizes.heights[itemId]={h:dd.caption.height(),o:dd.caption.outerHeight()}}}});dd.capSizes.borders.t=dd.caption.css("border-top-width");dd.capSizes.borders.b=dd.caption.css("border-bottom-width");dd.capSizes.margins.t=dd.caption.css("margin-top");dd.capSizes.margins.b=dd.caption.css("margin-bottom");dd.capSizes.padding.t=dd.caption.css("padding-top");dd.capSizes.padding.b=dd.caption.css("padding-bottom");dd.thumbs.append(thumbContent).ready(function(){if(dd.settings.thumbs){dd.thumbW=dd.thumbs.children("a:first-child").outerWidth(true);dd.thumbH=dd.thumbs.children("a:first-child").outerHeight(true);dd.controlH=dd.thumbH;dd.caption.css({bottom:dd.controlH})}else{dd.thumbWrap.css({display:"none"});dd.controlH=parseInt(dd.stage.height());dd.caption.css({bottom:0})}if(dd.settings.arrows){if(dd.settings.thumbs){dd.controls.append(arrowTpl)}else{dd.gal.append(arrowTpl)}}else{dd.gal.find(".ddGallery-arrows").css({display:"none"})}dd.gal.ready(function(){dd.gal.find(".ddGallery-arrows").css({"z-index":dd.mainZ+2});dd.gal.find(".ddGallery-arrows .circle").css({"z-index":dd.mainZ+3});dd.gal.find(".ddGallery-arrows .arrow").css({"z-index":dd.mainZ+4});dd.navW=dd.gal.find(".ddGallery-arrows").width();dd.circleSize=(dd.navW<dd.controlH)?dd.navW:dd.controlH;dd.circleSize=Math.floor(dd.circleSize*0.75);if(dd.settings.thumbs){dd.gal.find(".ddGallery-arrows .circle").css({width:dd.circleSize,height:dd.circleSize,top:Math.floor((dd.controlH/2)-(dd.circleSize/2)),left:Math.floor((dd.navW/2)-(dd.circleSize/2))})}else{dd.gal.find(".ddGallery-arrows .circle").css({display:"none"})}dd.arrowW=Math.ceil(dd.circleSize*0.6);dd.arrowH=Math.ceil((dd.arrowW*1.1)/2);dd.gal.find(".ddGallery-arrows .arrow").css({top:Math.floor((dd.controlH/2)-(dd.arrowH)),left:Math.floor(((dd.navW/2)-(dd.arrowW/2))-(dd.arrowW*0.1)),"border-left-width":"0","border-top":"solid transparent "+dd.arrowH+"px","border-bottom":"solid transparent "+dd.arrowH+"px","border-right":"solid #fff "+dd.arrowW+"px"});dd.gal.find(".ddGallery-arrow-right .arrow").css({left:Math.floor(((dd.navW/2)-(dd.arrowW/2))+(dd.arrowW*0.1)),"border-right":"solid 0 transparent","border-left":"solid #fff "+dd.arrowW+"px"});dd.navW=dd.gal.find(".ddGallery-arrows").outerWidth();if(!dd.settings.thumbs){dd.gal.find(".ddGallery-arrows").addClass("active nothumbs").children(".arrow").css({display:"block"});dd.controlH=0}else{dd.controlH=dd.controls.css({width:"100%",height:dd.controlH,display:((dd.settings.thumbs)?"block":"none")}).outerHeight();dd.thumbWrap.css({margin:("0 "+dd.navW+"px")});dd.thumbs.css({width:(dd.thumbW*dd.itemCount)});if(dd.thumbs.width()>dd.thumbWrap.width()){dd.gal.find(".ddGallery-arrow-right").addClass("active").children("span").css({display:"block"});dd.maxScroll=(dd.thumbs.outerWidth()-dd.thumbWrap.outerWidth())*-1}}dd.sH=(dd.settings.controlPush||(dd.settings.controlPushOnFull&&dd.fullScreen))?dd.stage.height()-dd.controlH:dd.stage.height()});dd.gal.ready(function(){dd.gal.find(".ddGallery-thumbs a:first-child").click();if(!dd.settings.thumbs){dd.gal.find(".ddGallery-arrows").stop(1,0).animate({opacity:0},dd.settings.controlHideSpeed)}else{if(dd.settings.hideThumbs){dd.controls.css({bottom:(-1*dd.controlH)})}}if(dd.settings.captions){dd.caption.css({height:0,bottom:((dd.settings.hideThumbs||!dd.settings.thumbs)?0:dd.controlH)}).addClass("collapsed")}if(dd.settings.pinTab){dd.tab.css({bottom:dd.tabB+((dd.settings.hideThumbs)?0:dd.controlH)})}if(dd.settings.pinned&&dd.settings.pinTab){dd.tab.mouseup()}})});dd.gal.find(".ddGallery-thumbs a").on("click",function(e){e.preventDefault();var thisThumb=$(this),type=thisThumb.attr("class"),typeFrom=dd.thumbs.children("a:nth-child("+dd.curItem+")").attr("class"),url=thisThumb.attr("href"),itemId=thisThumb.attr("itemId"),cap=thisThumb.attr("title"),sourceId=thisThumb.attr("sourceId"),sourceClass=thisThumb.attr("sourceClass"),linkOut=thisThumb.attr("linkOut"),linkTarget=thisThumb.attr("linkTarget"),tL=parseInt(dd.thumbs.css("left")),thumbL=parseInt(thisThumb.position().left)-(parseInt(thisThumb.css("border-left-width")))-(parseInt(thisThumb.css("margin-left"))),newLeft,isLast=false,dir=(dd.curItem==1&&($(this).index()+1)==dd.itemCount&&dd.itemCount>2&&dd.navSource!="")?false:(dd.curItem==dd.itemCount&&($(this).index()+1)==1&&dd.navSource!="")?true:(dd.curItem<($(this).index()+1));dd.sH=(dd.settings.controlPush||(dd.settings.controlPushOnFull&&dd.fullScreen))?dd.stage.height()-dd.controlH:dd.stage.height();dd.curItem=$(this).index()+1;isLast=dd.curItem==dd.itemCount;if(dd.navSource=="left"&&dd.itemCount<3){dir=!dir}dd.navSource="";thisThumb.siblings("a").removeClass("selected");if(type=="youtube"&&window.ddGalleryWaitForYoutube){setTimeout(function(){thisThumb.click()},0);return}if(!($(this).is(".selected")||dd.animating)){dd.wW=dd.thumbWrap.width();cap=(cap=="undefined")?"":cap;dd.animating=true;dd.stage.stop(1,0);dd.caption.stop(1,0);dd.stage.find(".ddGallery-youtube-wrapper").each(function(){dd.autoPause=true;dd.youtubePlayers[$(this).attr("id")].pauseVideo()});if(dd.autopinned){dd.tab.mouseup()}clearTimeout(dd.rotator);clearTimeout(dd.captionDelay);thisThumb.siblings("a").removeClass("selected");thisThumb.addClass("selected");dd.stage.addClass("loading");if(dd.stage.find(".selected").length>0){eval("dd.animOut_"+dd.settings.stageRotateType+'(dd.stage.find(".selected"),type,typeFrom,dir);')}if(!dd.settings.thumbs&&type=="youtube"){dd.gal.find(".ddGallery-arrows").css({height:dd.stage.height()-35})}else{dd.gal.find(".ddGallery-arrows").css({height:"100%"})}if(dd.stage.find("#"+itemId).length===0){switch(type){case"img":dd.stage.append('<img src="'+url+'" class="ddGallery-item" id="'+itemId+'" alt="'+cap+'" style="opacity:0;position:absolute;" />');dd.stage.children("#"+itemId).load(function(){dd.stage.removeClass("loading");dd.stage.find("#"+itemId).addClass("selected");dd.setImageDimensions(dd.stage.children("#"+itemId),typeFrom,dir,"in")});break;case"clickable":dd.stage.append('<a href="'+linkOut+'" target="'+linkTarget+'"><img id="'+itemId+'" src="'+url+'" class="ddGallery-item" alt="'+cap+'" style="opacity:0;position:absolute;" /></a>');dd.stage.find("#"+itemId).load(function(){dd.stage.removeClass("loading");dd.stage.find("#"+itemId).addClass("selected");dd.setImageDimensions(dd.stage.find("#"+itemId),typeFrom,dir,"in")});break;case"div":dd.showZoom(false,dd.settings.stageRotateSpeed);dd.stage.append('<div class="ddGallery-div-wrapper ddGallery-item" id="'+itemId+'" style="opacity:0;position:absolute;width:100%;height:'+dd.sH+'px;overflow:auto"><div class="'+sourceClass+'" id="'+sourceId+'">'+dd.orig.find("."+itemId).html()+"</div></div>").ready(function(){dd.stage.removeClass("loading");dd.stage.find("#"+itemId).addClass("selected");eval("dd.animIn_"+dd.settings.stageRotateType+'(dd.gal.find("#"+itemId),type,typeFrom,dir);')});break;case"iframe":dd.showZoom(false,dd.settings.stageRotateSpeed);dd.stage.append('<div class="ddGallery-iframe-wrapper ddGallery-item" style="opacity:0;position:absolute;width:100%;height:'+dd.sH+'px;overflow:auto" id="'+itemId+'"><iframe style="border:none;width:100%;height:100%;" class="'+sourceClass+'" id="'+sourceId+'" src="'+url+'"></iframe></div>').ready(function(){dd.stage.removeClass("loading");dd.stage.find("#"+itemId).addClass("selected");eval("dd.animIn_"+dd.settings.stageRotateType+'(dd.gal.find("#"+itemId),type,typeFrom,dir);')});break;case"youtube":dd.showZoom(false,dd.settings.stageRotateSpeed);dd.stage.append('<div class="ddGallery-youtube-wrapper ddGallery-item" style="opacity:0;position:absolute;width:100%;height:'+dd.sH+'px;overflow:hidden" id="'+itemId+'"><div id="'+itemId+'-video"></div></div>').ready(function(){dd.stage.removeClass("loading");dd.stage.find("#"+itemId).addClass("selected");eval("dd.animIn_"+dd.settings.stageRotateType+'(dd.gal.find("#"+itemId),type,typeFrom,dir);');dd.youtubePlayers[itemId]=new window.YT.Player(itemId+"-video",{height:"100%",width:"100%",videoId:url,playerVars:{wmode:"opaque"},events:{onReady:function(event){dd.animating=false;if(dd.settings.autoPlay||(dd.settings.playlist&&!dd.userPaused)){event.target.playVideo()}},onStateChange:function(event){switch(event.data){case window.YT.PlayerState.BUFFERING:case window.YT.PlayerState.PLAYING:clearTimeout(dd.rotator);clearTimeout(dd.youtubeDelay);dd.youtubeDelay=false;dd.videoPlaying=true;dd.userPaused=false;if(!dd.pinned){dd.tab.mouseup();dd.autopinned=true}break;case window.YT.PlayerState.PAUSED:if(!dd.autoPause){dd.userPaused=true}dd.autoPause=false;if(!dd.youtubeDelay){dd.youtubeDelay=setTimeout(function(){dd.videoPlaying=false;if(dd.pinned&&dd.autopinned){dd.tab.mouseup()}if(dd.settings.rotate&&(!dd.hover||!dd.settings.hoverPause)&&!dd.settings.playlist){clearTimeout(dd.rotator);dd.rotator=setTimeout(function(){dd.navSource="auto";dd.rotateItems(true)},dd.settings.stagePause)}},300)}break;case window.YT.PlayerState.ENDED:if(dd.settings.playlist&&!isLast){dd.userPaused=false;event.target.seekTo(0,true);dd.navSource="auto";dd.rotateItems(true)}else{if(!dd.youtubeDelay){dd.youtubeDelay=setTimeout(function(){dd.videoPlaying=false;if(dd.pinned&&dd.autopinned){dd.tab.mouseup()}if(dd.settings.rotate&&(!dd.hover||!dd.settings.hoverPause)){clearTimeout(dd.rotator);dd.rotator=setTimeout(function(){dd.navSource="auto";dd.rotateItems(true)},dd.settings.stagePause)}},300)}}break}}}})});break;case"vimeo":dd.stage.append('<div class="ddGallery-vimeo-wrapper" style="opacity:0;position:absolute;width:100%;height:'+dd.sH+'px;overflow:hidden" id="'+itemId+'"><iframe style="border:none;width:100%;height:100%;" class="'+sourceClass+'" id="'+sourceId+'" src="'+url+'"></div></div>').ready(function(){dd.stage.removeClass("loading");dd.stage.find("#"+itemId).addClass("selected");eval("dd.animIn_"+dd.settings.stageRotateType+'(dd.gal.find("#"+itemId),type,typeFrom,dir);')});break}}else{dd.stage.find("#"+itemId).addClass("selected");if(type=="img"){dd.stage.removeClass("loading");dd.setImageDimensions(dd.stage.children("#"+itemId),typeFrom,dir,"in")}else{if(type=="clickable"){dd.stage.removeClass("loading");dd.setImageDimensions(dd.stage.find("#"+itemId),typeFrom,dir,"in")}else{dd.stage.find("#"+itemId).css({height:dd.sH});dd.showZoom(false,dd.settings.stageRotateSpeed);dd.stage.removeClass("loading");eval("dd.animIn_"+dd.settings.stageRotateType+'(dd.gal.find("#"+itemId),type,typeFrom,dir);');if(dd.settings.playlist&&!dd.userPaused){dd.youtubePlayers[itemId].seekTo(0,true);dd.youtubePlayers[itemId].playVideo()}}}}if(dd.settings.count){switch(dd.settings.countType){case"total":dd.count.html(dd.itemCount);break;case"paged":dd.count.html(dd.curItem+" of "+dd.itemCount);break}}if(dd.settings.captions){if(dd.settings.externalCaptions){dd.caption.css({display:"none"});$(dd.settings.externalCaptions).html('<span class="ddGallery-externalCaptions">'+cap+"</span>")}else{dd.caption.attr("itemId",itemId).children(".ddGallery-caption").html(cap).ready(function(){var con=false;if(!dd.pinned){if(dd.settings.thumbs&&((!dd.settings.hideThumbs||dd.hover)||(!dd.settings.hideThumbsOnFull&&dd.fullScreen))){con=true}dd.moveControls(itemId,con,true,dd.settings.stageRotateSpeed)}dd.captionTimer(con)})}}else{dd.caption.css({display:"none"});dd.tab.css({bottom:dd.tabB+(dd.controlH+parseInt(dd.controls.css("bottom")))})}if(dd.settings.thumbs){if((thumbL+dd.thumbW)>dd.wW-tL){newLeft=(dd.maxScroll>(thumbL*-1))?dd.maxScroll:(thumbL*-1);dd.thumbs.stop(1,0).animate({left:newLeft},dd.settings.controlScrollSpeed,function(){if(dd.settings.arrows){dd.arrowDisplay()}})}else{if((thumbL*-1)>tL){newLeft=0-thumbL;dd.thumbs.stop(1,0).animate({left:newLeft},dd.settings.controlScrollSpeed,function(){if(dd.settings.arrows){dd.arrowDisplay()}})}}}}});dd.gal.on("click",".ddGallery-arrow-left",function(e){e.preventDefault();if(dd.settings.thumbs){var tL=parseInt(dd.thumbs.css("left")),newLeft,c;c=Math.ceil(dd.wW/dd.thumbW)-1;if(c<1){c=1}newLeft=tL+(c*dd.thumbW);newLeft=(newLeft>0)?0:newLeft;dd.thumbs.stop(1,0).animate({left:newLeft},dd.settings.controlScrollSpeed,function(){if(dd.settings.arrows){dd.arrowDisplay()}})}else{dd.navSource="left";dd.rotateItems(false)}});dd.gal.on("click",".ddGallery-arrow-right",function(e){e.preventDefault();if(dd.settings.thumbs){var tL=parseInt(dd.thumbs.css("left")),newLeft,c;c=Math.ceil(dd.wW/dd.thumbW)-1;if(c<1){c=1}newLeft=tL-(c*dd.thumbW);newLeft=(newLeft<dd.maxScroll)?dd.maxScroll:newLeft;dd.thumbs.stop(1,0).animate({left:newLeft},dd.settings.controlScrollSpeed,function(){if(dd.settings.arrows){dd.arrowDisplay()}})}else{dd.navSource="right";dd.rotateItems(true)}});if(dd.settings.keyboard){$(document).on("keydown."+dd.id,function(e){switch(e.keyCode){case 37:dd.navSource="left";dd.rotateItems(false);break;case 39:dd.navSource="right";dd.rotateItems(true);break}})}dd.gal.on("mouseenter",function(){var con=false,rs=false;dd.hover=true;if(dd.settings.hoverPause){clearTimeout(dd.rotator)}if(dd.captionDelay){clearTimeout(dd.captionDelay)}if(!dd.settings.thumbs&&dd.settings.arrows){dd.gal.find(".ddGallery-arrows").stop(1,0).animate({opacity:1},dd.settings.controlHideSpeed)}if(dd.settings.count&&(dd.settings.hideCount||(dd.settings.hideCountOnFull&&dd.fullScreen))){dd.count.stop(1,0).animate({opacity:0},dd.settings.controlHideSpeed)}if(dd.thumbs.find(".selected").is(".img, .clickable")){rs=dd.imageDimensions[dd.thumbs.find(".selected").attr("itemId")].o.z}if(dd.settings.zoom&&dd.settings.hideZoom&&rs){dd.showZoom(true,dd.settings.controlHideSpeed)}if(!dd.pinned){if(dd.settings.thumbs){con=true}dd.moveControls(dd.caption.attr("itemId"),con,true,dd.settings.controlHideSpeed)}});dd.gal.on("mouseleave",function(){var con=false;dd.hover=false;if(dd.settings.rotate&&dd.settings.hoverPause&&!dd.videoPlaying){clearTimeout(dd.rotator);dd.rotator=setTimeout(function(){dd.navSource="auto";dd.rotateItems(true)},dd.settings.stagePause)}if(!dd.settings.thumbs&&dd.settings.arrows){dd.gal.find(".ddGallery-arrows").stop(1,0).animate({opacity:0},dd.settings.controlHideSpeed)}if(dd.settings.count&&(dd.settings.hideCount&&!(dd.settings.hideCountOnFull&&dd.fullScreen))){dd.count.stop(1,0).animate({opacity:1},dd.settings.controlHideSpeed)}if(dd.settings.zoom&&dd.settings.hideZoom){dd.showZoom(false,dd.settings.controlHideSpeed)}if(!dd.pinned){if(dd.settings.thumbs&&(!dd.settings.hideThumbs||(!dd.settings.hideThumbsOnFull&&dd.fullScreen))){con=true}dd.moveControls(dd.caption.attr("itemId"),con,true,dd.settings.controlHideSpeed)}dd.captionTimer(con)});dd.stage.on("touchend",function(){if(dd.zoom.is(".active")){}else{clearTimeout(dd.touchy);if(dd.touched){dd.touched=false;dd.gal.mouseleave()}else{dd.touched=true;dd.gal.mouseenter();dd.touchy=setTimeout(function(){dd.touched=false;dd.gal.mouseleave()},dd.settings.stagePause/2)}}});if(dd.settings.thumbs){dd.thumbs.on("touchstart",function(event){clearTimeout(dd.touchy);$(document).on("touchmove",function(event){var e=event.originalEvent;e.preventDefault()});var e=event.originalEvent,tStartX=e.touches[0].pageX,nStartL=parseInt(dd.thumbs.css("left"));dd.thumbs.on("touchmove",function(event){var e=event.originalEvent,x=e.touches[0].pageX,nL=nStartL+(x-tStartX);nL=(nL<dd.maxScroll)?dd.maxScroll:(nL>0)?0:nL;dd.thumbs.css({left:nL})})});dd.thumbs.on("touchend",function(event){$(document).off("touchmove");dd.arrowDisplay()})}if(dd.settings.zoom){dd.zoom.on("click",function(e){var image=dd.stage.find(".selected");if(dd.zoom.is(".active")){dd.zoom.removeClass("active");image.off();dd.setImageDimensions(image,"","","unzoom")}else{dd.zoom.addClass("active");var sW=dd.stage.width(),iW=dd.imageDimensions[image.attr("id")].o.w,iH=dd.imageDimensions[image.attr("id")].o.h,tW=Math.floor(sW*0.6),tH=Math.floor(dd.sH*0.6),tX=Math.floor((sW-tW)/2)+dd.stage.offset().left,tY=Math.floor((dd.sH-tH)/2)+dd.stage.offset().top,x=e.pageX-tX,y=e.pageY-tY;clearTimeout(dd.touchy);x=(x>tW)?tW:(x<0)?0:x;y=(y>tH)?tH:(y<0)?0:y;image.animate({left:((iW>sW)?(-1*Math.ceil((x/tW)*(iW-sW))):Math.floor((sW-iW)/2)),top:((iH>dd.sH)?(-1*Math.ceil((y/tH)*(iH-dd.sH))):Math.floor((dd.sH-iH)/2)),width:iW,height:iH},dd.settings.controlHideSpeed,function(){image.on("mousemove",function(e){var tX=Math.floor((sW-tW)/2)+dd.stage.offset().left,tY=Math.floor((dd.sH-tH)/2)+dd.stage.offset().top,x=e.pageX-tX,y=e.pageY-tY;x=(x>tW)?tW:(x<0)?0:x;y=(y>tH)?tH:(y<0)?0:y;if(iW>sW){image.css({left:-1*Math.ceil((x/tW)*(iW-sW))})}if(iH>dd.sH){image.css({top:-1*Math.ceil((y/tH)*(iH-dd.sH))})}});image.on("touchstart",function(event){clearTimeout(dd.rotator);clearTimeout(dd.touchy);dd.touched=false;dd.gal.mouseleave();$(document).on("touchmove",function(event){var e=event.originalEvent;e.preventDefault()});var e=event.originalEvent,tStartX=e.touches[0].pageX,tStartY=e.touches[0].pageY,iStartL=parseInt(image.css("left")),iStartT=parseInt(image.css("top"));image.on("touchmove",function(event){var e=event.originalEvent,x=e.touches[0].pageX,y=e.touches[0].pageY,nL=iStartL+(x-tStartX),nT=iStartT+(y-tStartY);nL=(nL<((iW-sW)*-1))?((iW-sW)*-1):(nL>0)?0:nL;nT=(nT<((iH-dd.sH)*-1))?((iH-dd.sH)*-1):(nT>0)?0:nT;if(iW>sW){image.css({left:nL})}if(iH>dd.sH){image.css({top:nT})}})});image.on("touchend",function(event){$(document).off("touchmove");dd.touched=true;dd.gal.mouseenter();dd.touchy=setTimeout(function(){dd.touched=false;dd.gal.mouseleave()},dd.settings.stagePause/2)})})}})}if(dd.settings.fullScreen){dd.full.on("click",function(){if(dd.fullScreen){dd.full.removeClass("active");dd.fullScreen=false;dd.resizeMe(false)}else{dd.full.addClass("active");dd.fullScreen=true;dd.resizeMe(true)}})}dd.tab.on("mouseup touchend",function(){var con=false;clearTimeout(dd.tabTouchy);dd.tabTouchy=setTimeout(function(){if(dd.pinned){dd.pinned=false;dd.tab.removeClass("pinned");dd.autopinned=false;if(dd.hover){dd.gal.mouseenter()}else{dd.gal.mouseleave()}}else{dd.pinned=true;dd.tab.addClass("pinned");dd.touched=false;if(dd.settings.thumbs&&(!dd.settings.hideThumbs||(dd.settings.controlPushOnFull&&dd.fullScreen))){con=true}dd.moveControls(dd.caption.attr("itemId"),con,false,dd.settings.controlHideSpeed)}},100)});$(window).on("resize."+dd.id,function(){clearTimeout(dd.windowResizer);dd.windowResizer=setTimeout(function(){if(!dd.fullScreen){dd.gal.css({"z-index":"",position:"",top:"",left:"",width:"",height:"",margin:""});dd.origCSS={"z-index":dd.gal.css("z-index"),position:(dd.gal.css("position")=="static")?"relative":dd.gal.css("position"),top:dd.gal.css("top"),left:dd.gal.css("left"),width:dd.gal.css("width"),height:dd.gal.css("height"),margin:dd.gal.css("margin")};dd.gal.css(dd.origCSS)}dd.resizeMe(dd.fullScreen)},100)})})},animFinish:function(item){var dd=this;dd.stage.find("img").off();dd.zoom.removeClass("active");dd.animating=false;if(dd.settings.rotate&&(!dd.hover||!dd.settings.hoverPause)){dd.rotator=setTimeout(function(){dd.navSource="auto";dd.rotateItems(true)},dd.settings.stagePause)}dd.initial=false},animOut_fade:function(item,type,typeFrom,dir){var dd=this;item.stop(1,0).animate({opacity:0},dd.settings.stageRotateSpeed,function(){item.css({display:"none"}).removeClass("selected")})},animIn_fade:function(item,type,typeFrom,dir){var dd=this;item.stop(1,0).css({display:"block",opacity:0}).animate({opacity:1},(dd.initial?dd.initialSpeed:dd.settings.stageRotateSpeed),function(){dd.animFinish(item)})},animOut_pushH:function(item,type,typeFrom,dir){var dd=this,m=dd.stage.width(),nL=(parseInt(item.css("left"))||0);if(dir){m=m*-1}item.stop(1,0).animate({left:nL+m},dd.settings.stageRotateSpeed,function(){item.css({display:"none",left:0}).removeClass("selected")})},animIn_pushH:function(item,type,typeFrom,dir){var dd=this,m=dd.stage.width(),oL=(parseInt(item.css("left"))||0);oL=(oL>m||oL<0)?0:oL;if(!dir){m=m*-1}item.stop(1,0).css({display:"block",opacity:1,left:m}).animate({left:oL},(dd.initial?dd.initialSpeed:dd.settings.stageRotateSpeed),function(){dd.animFinish(item)})},animOut_pushV:function(item,type,typeFrom,dir){var dd=this,m=dd.sH,nT=(parseInt(item.css("top"))||0);if(dir){m=m*-1}item.stop(1,0).animate({top:nT+m},dd.settings.stageRotateSpeed,function(){item.css({display:"none",top:0}).removeClass("selected")})},animIn_pushV:function(item,type,typeFrom,dir){var dd=this,m=dd.sH,oT=(parseInt(item.css("top"))||0);oT=(oT>m||oT<0)?0:oT;if(!dir){m=m*-1}item.stop(1,0).css({display:"block",opacity:1,top:m}).animate({top:oT},(dd.initial?dd.initialSpeed:dd.settings.stageRotateSpeed),function(){dd.animFinish(item)})},animOut_slideH:function(item,type,typeFrom,dir){var dd=this;item.css({"z-index":dd.mainZ});dd.animOut_fade(item,type,typeFrom,dir)},animIn_slideH:function(item,type,typeFrom,dir){var dd=this;item.css({"z-index":dd.mainZ+1});dd.animIn_pushH(item,type,typeFrom,dir)},animOut_slideV:function(item,type,typeFrom,dir){var dd=this;item.css({"z-index":dd.mainZ});dd.animOut_fade(item,type,typeFrom,dir)},animIn_slideV:function(item,type,typeFrom,dir){var dd=this;item.css({"z-index":dd.mainZ+1});dd.animIn_pushV(item,type,typeFrom,dir)},animOut_lift:function(item,type,typeFrom,dir){var dd=this,oW,oH,oL,oT,nW,nH,nL,nT;item.css({"z-index":dd.mainZ+1});if(typeFrom=="img"||typeFrom=="img selected"){oW=item.width();oH=item.height();oL=parseInt(item.css("left"));oT=parseInt(item.css("top"));nW=Math.ceil(oW*2);nH=Math.ceil(oH*2);nL=Math.ceil(oL-((nW-oW)/2));nT=Math.ceil(oT-((nH-oH)/2));item.stop(1,0).animate({width:nW,height:nH,left:nL,top:nT,opacity:0},dd.settings.stageRotateSpeed,function(){item.css({width:oW,height:oH,left:oL,top:oT,display:"none"}).removeClass("selected")})}else{dd.animOut_fade(item,type,typeFrom,dir)}},animIn_lift:function(item,type,typeFrom,dir){var dd=this;item.css({"z-index":dd.mainZ});this.animIn_fade(item,type,typeFrom,dir)},animOut_drop:function(item,type,typeFrom,dir){var dd=this;item.css({"z-index":dd.mainZ});dd.animOut_fade(item,type,typeFrom,dir)},animIn_drop:function(item,type,typeFrom,dir){var dd=this,oW,oH,oL,oT,nW,nH,nL,nT;item.css({"z-index":dd.mainZ+1});if(type=="img"||type=="img selected"){oW=item.width();oH=item.height();oL=parseInt(item.css("left"));oT=parseInt(item.css("top"));nW=Math.ceil(oW*2);nH=Math.ceil(oH*2);nL=Math.ceil(oL-((nW-oW)/2));nT=Math.ceil(oT-((nH-oH)/2));item.stop(1,0).css({display:"block",width:nW,height:nH,left:nL,top:nT,opacity:0}).animate({width:oW,height:oH,left:oL,top:oT,opacity:1},(dd.initial?dd.initialSpeed:dd.settings.stageRotateSpeed),function(){dd.animFinish(item)})}else{dd.animIn_fade(item,type,typeFrom,dir)}},resizeMe:function(full){var dd=this,cur=dd.stage.find(".selected");dd.stage.find(".ddGallery-item").stop(1,1);if(full){dd.gal.css({"z-index":10000,position:"fixed",top:0,left:0,width:$(window).width(),height:$(window).height(),margin:0})}else{dd.gal.css(dd.origCSS)}dd.sH=(dd.settings.controlPush||(dd.settings.controlPushOnFull&&full))?dd.stage.height()-dd.controlH:dd.stage.height();if(dd.settings.pinTab){dd.tab.css({left:Math.floor(dd.stage.width()/2)-Math.floor(dd.tab.outerWidth()/2)})}if(dd.settings.thumbs&&dd.settings.arrows){dd.maxScroll=(dd.thumbs.outerWidth()-dd.thumbWrap.outerWidth())*-1}dd.arrowDisplay();if(dd.zoom.is(".active")){dd.zoom.click()}if(cur.is(".ddGallery-iframe-wrapper")||cur.is(".ddGallery-div-wrapper")||cur.is(".ddGallery-vimeo-wrapper")||cur.is(".ddGallery-youtube-wrapper")){cur.css({height:dd.sH})}else{dd.setImageDimensions(cur,"","","resize")}},setImageDimensions:function(image,typeFrom,dir,target){var dd=this,clickable=false,itemId=image.attr("id"),iW,iH,iR,orig,sW,sR,nW,nH,speed;if(target=="resize"){orig={width:image.css("width"),height:image.css("height"),top:image.css("top"),left:image.css("left")}}image.css({width:"",height:""});iW=image.width();iH=image.height();iR=iW/iH;sW=dd.stage.width();sR=sW/dd.sH;dd.imageDimensions[itemId]={o:{w:iW,h:iH,z:((iW>sW)||(iH>dd.sH))},n:{}};if(dd.settings.zoom){dd.zoom.removeClass("active");if(((iH>dd.sH)||(iW>sW))&&dd.settings.zoom&&(dd.hover||!dd.settings.hideZoom)){dd.showZoom(true,dd.settings.stageRotateSpeed)}else{dd.showZoom(false,dd.settings.stageRotateSpeed)}}if(dd.settings.stretch){iW=sW;iH=dd.sH}else{if(((iH>dd.sH)||(iW>sW))||(((iH<dd.sH)&&(iW<sW))&&dd.settings.enlarge)){if(sR>iR){nH=dd.sH;iW=Math.round(iW*(nH/iH));iH=nH}else{nW=sW;iH=Math.round(iH*(nW/iW));iW=nW}dd.imageDimensions[itemId].n={w:iW,h:iH}}}switch(target){case"in":speed=0;break;case"resize":image.css(orig);speed=0;break;case"unzoom":speed=dd.settings.controlHideSpeed;break}image.animate({width:iW,height:iH,left:((sW/2)-(iW/2)),top:((dd.sH/2)-(iH/2)),display:"block"},speed,function(){if(clickable){image=image.parent("a")}if(target=="in"){eval("dd.animIn_"+dd.settings.stageRotateType+'(image,"img",typeFrom,dir);')}})},showZoom:function(show,speed){var dd=this,s=((dd.zoom.css("display")=="block")?1:0),o=(show?1:0),d=(show?"block":"none");dd.zoom.css({display:"block",opacity:s}).animate({opacity:o},speed,function(){dd.zoom.css({display:d,opacity:""})})},moveControls:function(id,con,cap,speed){var dd=this,conH=0,capH=0;if(con){conH=dd.controlH}dd.controls.stop(1,0).animate({bottom:(conH-dd.controlH)},speed);if(dd.settings.captions&&!dd.settings.externalCaptions){dd.caption.stop(1,0).css({opacity:1});if(cap&dd.capSizes.heights[id]["h"]>0){capH=dd.capSizes.heights[id]["o"];dd.caption.animate({bottom:conH,height:dd.capSizes.heights[id]["h"],"margin-top":dd.capSizes.margins.t,"margin-bottom":dd.capSizes.margins.b,"padding-top":dd.capSizes.padding.t,"padding-bottom":dd.capSizes.padding.b,"border-top-width":dd.capSizes.borders.t,"border-bottom-width":dd.capSizes.borders.b},speed).removeClass("collapsed")}else{dd.caption.animate({height:0,bottom:conH,"margin-top":0,"margin-bottom":0,"padding-top":0,"padding-bottom":0,"border-top-width":0,"border-bottom-width":0},speed).addClass("collapsed")}}if(dd.settings.pinTab){dd.tab.stop(1,0).animate({bottom:dd.tabB+conH+capH},speed)}},rotateItems:function(forward){var dd=this,n=dd.curItem;if(forward){n=((n+1)<=dd.itemCount)?n+1:1}else{n=((n-1)>=1)?n-1:dd.itemCount}dd.thumbs.children("a:nth-child("+n+")").click()},captionTimer:function(showControls){var dd=this;if(!dd.pinned&&(dd.settings.captions&&!dd.settings.externalCaptions)&&(dd.settings.hideCaptions&&(dd.settings.hideCaptionsOnFull&&!dd.fullScreen))){clearTimeout(dd.captionDelay);dd.captionDelay=setTimeout(function(){dd.moveControls(dd.caption.attr("itemId"),showControls,false,dd.settings.captionFadeSpeed)},dd.settings.captionPause)}},arrowDisplay:function(){var dd=this,tL=parseInt(dd.thumbs.css("left"));if(tL>=0){dd.controls.find(".ddGallery-arrow-left").removeClass("active").children("span").css({display:"none"})}else{dd.controls.find(".ddGallery-arrow-left").addClass("active").children("span").css({display:"block"})}if(tL<=dd.maxScroll){dd.controls.find(".ddGallery-arrow-right").removeClass("active").children("span").css({display:"none"})}else{dd.controls.find(".ddGallery-arrow-right").addClass("active").children("span").css({display:"block"})}},destroy:function(){var dd=this;dd.gal.off();$(document).off("keydown."+dd.id);clearTimeout(dd.rotator);dd.gal.find().stop(1,0);$(dd.settings.externalCaptions).html("");dd.gal.html(dd.origData);dd.debug.html("")}};$.fn.ddGallery=function(options){var args=(typeof options==="object"||!options)?options:arguments[1];this.each(function(){var instance=$(this).data("ddGallery");if(instance){instance.destroy.apply($(this).data("ddGallery"));$(this).removeData("ddGallery")}if(options!="destroy"){$(this).data("ddGallery",new $.ddGallery(this,args))}});return this}})(jQuery);